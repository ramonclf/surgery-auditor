<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>SimulaÃ§Ã£o de Procedimento â€” Surgery Auditor</title>
  <link rel="stylesheet" href="styles/main.css" />
</head>
<body>
  <h2>SimulaÃ§Ã£o de Procedimento</h2>
  <p id="user-info">Carregando usuÃ¡rio...</p>

  <form id="simulador">
    <label for="porte">ðŸ”’ Porte (1 a 7):</label>
    <input type="number" id="porte" min="1" max="7" required />

    <label for="urgencia">ðŸ”’ UrgÃªncia:</label>
    <select id="urgencia" required>
      <option value="">Selecione</option>
      <option value="sim">Sim</option>
      <option value="nao">NÃ£o</option>
    </select>

    <label for="valor">ðŸ”’ Valor CirurgiÃ£o (R$):</label>
    <input type="number" id="valor" min="0" required />

    <button type="submit">ðŸ§ª Simular</button>
  </form>

  <div id="resultado" style="margin-top: 20px;"></div>
  <button onclick="window.location.href='painel.html'">Voltar ao Painel</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="firebaseConfig.js"></script>
  <script src="auth.js"></script>

  <script>
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        document.getElementById("user-info").innerText =
          `UsuÃ¡rio logado: ${user.email}`;
      } else {
        window.location.href = "login.html";
      }
    });

    document.getElementById("simulador").addEventListener("submit", function (e) {
      e.preventDefault();

      const porte = parseInt(document.getElementById("porte").value);
      const urgencia = document.getElementById("urgencia").value;
      const valor = parseFloat(document.getElementById("valor").value);

      if (isNaN(porte) || porte < 1 || porte > 7) {
        alert("Porte invÃ¡lido. Use um valor entre 1 e 7.");
        return;
      }

      if (urgencia !== "sim" && urgencia !== "nao") {
        alert("Selecione urgÃªncia.");
        return;
      }

      if (isNaN(valor) || valor <= 0) {
        alert("Valor invÃ¡lido.");
        return;
      }

      const acrescimo = urgencia === "sim" ? valor * 0.3 : 0;
      const valorFinal = valor + acrescimo;

      document.getElementById("resultado").innerHTML = `
        <h3>Resultado da SimulaÃ§Ã£o</h3>
        <ul>
          <li><strong>Porte:</strong> ${porte}</li>
          <li><strong>UrgÃªncia:</strong> ${urgencia}</li>
          <li><strong>Valor original:</strong> R$ ${valor.toFixed(2)}</li>
          <li><strong>AcrÃ©scimo aplicado:</strong> R$ ${acrescimo.toFixed(2)}</li>
          <li><strong>Valor final:</strong> R$ ${valorFinal.toFixed(2)}</li>
          <li><strong>LÃ³gica aplicada:</strong> v1.1.2</li>
          <li><strong>Escopo congelado:</strong> Porte, UrgÃªncia, Valor</li>
          <li><strong>Operadora ativa:</strong> Unimed DivinÃ³polis</li>
        </ul>
      `;
    });
  </script>
</body>
</html>
